Mura(function(){var t={siteID:"",endpoint:"",components:{},templates:{},rb:{},init:function(e,i){return t.siteID=e,t.endpoint=Mura.apiEndpoint,t},getEndpoint:function(){return t.endpoint},all:function(t){Mura.get(this.getEndpoint()+"?scaffold=1").then(function(e){var i=e.data.items,r=[];for(var o in i)r.push(i[o]);e.items=r,t(e)})},get:function(t,i,r,o,s,n){var a=this,p={},l=r||"new";"new"==l?Mura.getEntity(i).new().then(function(i){n||void 0===i.properties.links.edit?(p.model=i.getAll(),p.model._displaylist=[],p.entity=i,i.get("properties").then(function(i){p.properties=i.properties.properties,a.processProperties(p);for(var r=0;r<p.properties.length;r++)p.properties[r].listview&&p.model._displaylist.push(p.properties[r]),"datetime"!=p.properties[r].datatype&&"date"!=p.properties[r].datatype||(p.model[p.properties[r].name]=e.formatDate(p.model[p.properties[r].name]));t(p)})):location.href=i.properties.links.edit}):Mura.getEntity(i).loadBy("id",l).then(function(i){n||void 0===i.properties.links.edit?(p.model=i.getAll(),p.model._displaylist=[],p.entity=i,i.get("properties").then(function(i){p.properties=i.properties.properties,a.processProperties(p);for(var r=0;r<p.properties.length;r++)p.properties[r].listview?p.model._displaylist.push(p.properties[r]):p.properties[r].fieldtype,"datetime"!=p.properties[r].datatype&&"date"!=p.properties[r].datatype||(p.model[p.properties[r].name]=e.formatDate(p.model[p.properties[r].name]));t(p)},function(t){console.log("error!"),console.log(t)})):location.href=i.properties.links.edit})},processEntity:function(t,e,i){t(i)},related:function(t,e,i){var r={};e.get(i).then(function(e){r.collection=e.properties,t(r)},function(e){console.log("error"),console.log(e),r.error=e,t(r)})},feed:function(t,e,i,r,o,s){var n=this,a={},p=(i=i||(this.data&&this.data.itemsPer?this.data.itemsPer:0),Mura.getFeed(e).itemsPerPage(i));"entity"==e&&p.prop("scaffold").isEQ(1);var l=!1;if(Mura(".filter").each(function(){if(""!=Mura(this).val()){var t=Mura(this).attr("name").split("-")[1];p.prop(t).contains(Mura(this).val()),l=!0}}),s&&s.length)for(var d=0;d<s.length;d++)p.prop(s[d].property).contains(s[d].value);r&&p.sort(r,o),"content"==e&&p.includeHomepage(1).showExcludeSearch(1).showNavOnly(1),Mura.getEntity(e).new().then(function(e){e.get("properties").then(function(e){a.properties=e.properties.properties,a.parentproperties=e.properties,void 0===a.parentproperties.dynamic?a.parentproperties.dynamic=!1:"string"==typeof a.parentproperties.dynamic&&("0"==a.parentproperties.dynamic||"false"==a.parentproperties.dynamic.toLowerCase()?a.parentproperties.dynamic=!1:a.parentproperties.dynamic=!0),n.processProperties(a),a.hasFilterApplied=l,p.expand(a.expand.join()),p.getQuery().then(function(e){p.getQuery().then(function(e){a.collection=e,a.list=e.getAll().items,a.links=e.getAll().links,a.loaded=!0,t(a)})})})})},page:function(t,e,i){var r=this,o={};e.get(i).then(function(e){o.collection=e,o.list=e.getAll().items,o.links=e.getAll().links,e.get("properties").then(function(e){o.properties=e.properties.properties,r.processProperties(o),t(o)})})},save:function(t,e,i){Mura.getEntity(e).set(i).save().then(function(e){t(e)},function(e){t(e,!0)})},delete:function(t,e,i){Mura.getEntity(e).set(i).delete().then(function(e){t(e)})},getRenderType:function(t){return"text"==t.datatype?"textarea":"int"==t.datatype&&t.default<=1?"checkbox":"textfield"},buildUrl:function(t,e,i,r){var o=this.endpoint;if(o+=t||"",o+=e?"/"+e:"",i)o+="/properties";else if(r&&r.length)for(var s in o+="/?",r)o+=s+"="+r[s];return encodeURI(o)},processProperties:function(t){var e=1e4,i=!1;t.expand=[],t.listview=[],t.properties.sort(this.propertySort);for(var r=0;r<t.properties.length;r++){(o=t.properties[r]).listview&&(o.listposition=r,t.listview.push(o)),"null"==o.default&&(o.default=null),o.orderno||(o.orderno=e++),o.optionlist&&(o.optionlist=o.optionlist.split("^")),o.optionvaluelist&&(o.optionvaluelist=o.optionvaluelist.split("^")),o.rendertype&&""!=o.rendertype||(o.rendertype=this.getRenderType(o)),(1==o.filter||"true"==o.filter||"string"==typeof o.filter&&"yes"==o.filter.toLowerCase())&&(i=!0),o.displayname&&""!=o.displayname||(o.displayname=o.name),o.displayname=o.displayname.charAt(0).toUpperCase()+o.displayname.slice(1)}if(!t.listview.length){for(r=0;r<t.properties.length;r++){"name"!=(o=t.properties[r]).name&&"title"!=o.name&&"summary"!=o.name&&"description"!=o.name&&"lastupdate"!=o.name&&"created"!=o.name&&"fname"!=o.name&&"lname"!=o.name&&"firstname"!=o.name&&"lastname"!=o.name&&"company"!=o.name&&"organization"!=o.name||o.relatesto&&""!=o.relatesto||(o.listposition=r,t.listview.push(o))}if(!t.listview.length)for(r=0;r<t.properties.length;r++){(o=t.properties[r]).relatesto&&""!=o.relatesto||(o.listposition=r,t.listview.push(t.properties[r]))}}for(r=0;r<t.listview.length;r++){var o;"one-to-one"!=(o=t.listview[r]).fieldtype&&"many-to-one"!=o.fieldtype||t.expand.push(o.name)}if(!i)for(r=0;r<t.listview.length;r++)t.listview[r].filter=!0;return t},propertySort:function(t,e){return t.orderno||(t.orderno=0),e.orderno||(e.orderno=0),parseInt(t.orderno)-parseInt(e.orderno)},registerComponent:function(t,e){this.components[e]=t},qstring:function(){var t={},e=window.location.href,i="",r="",o="";if(e.split("?").length<2)return t;if((i=e.split("?")[1]).includes("&")){r=i.split("&");for(var s=0;s<r.length;s++)o=r[s].split("="),t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}else o=i.split("="),t[decodeURIComponent(o[0])]=decodeURIComponent(o[1]);return t},formatDate:function(t){if(!t)return"";var e=(t=t.split("T")[0]).split("-");return 0==dtFormat[0]?e[1]+dtCh+e[2]+dtCh+e[0]:e[2]+dtCh+e[1]+dtCh+e[0]}},e=new t.init(Mura.siteid);e.qstring();Vue.component("scaffold-all-template",{template:"#scaffold-all-template",props:["data"],methods:{showList:function(t){Scaffolder.showList(t)}}}),Vue.component("scaffold-error-template",{template:"#scaffold-error-template",props:["errordata"],methods:{}}),Vue.component("scaffold-crumb-template",{template:"#scaffold-crumb-template",props:["data","state"],methods:{clickCrumb:function(t){Scaffolder.clickCrumb(t)}}}),Vue.component("scaffold-form-template",{template:"#scaffold-form-template",props:["entityname","data","entityid","errordata"],methods:{openEndpoint:function(){window.open(e.getEndpoint()+this.$props.entityname+"/"+this.$props.data.model.id,"_blank")},clickSave:function(){e.Scaffold=this,Scaffolder.clickSave(this.entityname)},clickBack:function(){e.Scaffold=this,Scaffolder.clickBack()},clickDelete:function(){e.Scaffold=this,Scaffolder.clickDelete(this.entityname)},showAll:function(){Scaffolder.showList("entity")},showList:function(t){Scaffolder.showList(t)}}}),Vue.component("scaffold-list-template",{template:"#scaffold-list-template",props:["entityname","data","state","currentparent","issuperuser"],mounted:function(){this.$parent.state=[],this.entityTransitionLoader()},data:function(){return{listtransition:!1}},watch:{data:function(){this.listtransition=!1}},methods:{openEndpoint:function(){"entity"==this.$props.entityname?window.open(e.getEndpoint(),"_blank"):window.open(e.getEndpoint()+this.$props.entityname,"_blank")},entityTransitionLoader:function(){delete this.data.list,setTimeout(function(){$(".scaffolder-list-entity-loader > .load-inline").spin(spinnerArgs2)},10)},listTransitionLoader:function(){this.listtransition=!0,setTimeout(function(){$(".scaffolder-list-transition-loader  > .load-inline").spin(spinnerArgs2)},10)},goToAssembler:function(t){location.href="./?muraAction=scaffold.assembler&entityname="+t},showForm:function(t,e,i){Scaffolder.showForm(t,e,i)},applyFilter:function(t){this.listTransitionLoader(),Scaffolder.applyFilter(t)},removeFilter:function(){Mura(".filter").val(""),this.listTransitionLoader(),Scaffolder.applyFilter()},applyKeyFilter:function(t){13==t.keyCode&&(this.listTransitionLoader(),Scaffolder.applyKeyFilter(t))},applySortBy:function(t){this.listTransitionLoader(),Scaffolder.applySortBy(t)},applyPage:function(t){this.listTransitionLoader(),Scaffolder.applyPage(t)},applyItemsPer:function(t){this.listTransitionLoader(),Scaffolder.applyItemsPer(t.target.value)},showAll:function(){this.showList("entity")},showList:function(t){this.entityTransitionLoader(),Scaffolder.showList(t)},formatDate:function(t){return e.formatDate(t)}}}),Vue.component("scaffold-related-one",{template:"#scaffold-related-one",props:["property","model","entityid"],methods:{doDefault:function(t,e,i){t&&e&&(i[e]=t)}}}),Vue.component("scaffold-related-many-one",{template:"#scaffold-related-many-one",props:["property","model","entity"],mounted:function(){e.feed(this.proplist,this.property.relatesto)},data:function(){return{data:{},mparent:{},properties:[],loaded:!1}},methods:{proplist:function(t){if(this.mparent={},this.properties=t.properties,this.mparent.list=t.list,!this.property.renderfield&&t.list.length){var e=t.list[0];e.name?this.property.renderfield="name":e.menutitle?this.property.renderfield="item":e.title?this.property.renderfield="title":e.groupname?this.property.renderfield="groupname":e.company?this.property.renderfield="company":e.organization?this.property.renderfield="organization":e.label&&(this.property.renderfield="label")}this.mparent.properties=t.parentproperties,this.loaded=!0},doDefault:function(t,e,i){t&&e&&(i[e]=t)},showForm:function(t,e,i){Scaffolder.showForm(t,e,i)}}}),Vue.component("scaffold-related-many",{template:"#scaffold-related-many",props:["property","entity","related","entityid"],data:function(){return{mrelated:this.related?JSON.parse(this.related):{}}},mounted:function(){e.related(this.proplist,this.entity,this.property.name)},methods:{proplist:function(t){this.mrelated=t},showForm:function(t,e,i){Scaffolder.showForm(t,e,i)},showRelatedList:function(t,e){Scaffolder.showRelatedList(t,e)}},computed:{}}),Vue.component("scaffold-field-text-readonly",{template:"#scaffold-field-text-readonly",props:["property","model","entity","list"]}),Vue.component("scaffold-field-text",{template:"#scaffold-field-text",props:["property","model","entity","list"]}),Vue.component("scaffold-field-htmleditor",{template:"#scaffold-field-htmleditor",props:["property","model","entity","list"],mounted:function(){setHTMLEditors()}}),$&&(dtLocale?$.datepicker.setDefaults($.datepicker.regional[dtLocale]):$.datepicker.setDefaults($.datepicker.regional[""])),Vue.component("scaffold-field-text",{template:"#scaffold-field-text",props:["property","model","entity"],methods:{formatDate:function(t){return e.formatDate(t)}},mounted:function(){var t=this;!$||"date"!=this.$props.property.datatype&&"datetime"!=this.$props.property.datatype&&"date"!=this.$props.property.validate||$('input[name="'+this.$props.property.name+'"]').datepicker({minDate:1,onSelect:function(e){e&&(t.$props.model[t.$props.property.name]=e)}})}}),Vue.component("scaffold-field-textarea",{template:"#scaffold-field-textarea",props:["property","model","entity"]}),Vue.component("scaffold-field-checkbox",{template:"#scaffold-field-checkbox",props:["property","model","entity"]}),Vue.component("scaffold-field-dropdown",{template:"#scaffold-field-dropdown",props:["property","model","entity"]}),Vue.component("scaffold-field-radio",{template:"#scaffold-field-radio",props:["property","model","entity"]}),Vue.component("scaffold-field-file",{template:"#scaffold-field-file",props:["property","model","entity","list"],mounted:function(){MuraFileBrowser.config.resourcepath="User_Assets",setFinders('button[data-target="'+this.$props.property.name+'"]',{resourcepath:"User_Assets"})}}),Scaffolder=new Vue({el:"#container-scaffold",data:{all:[],sortBy:"",sortDir:"",isvisible:!1,itemsper:10,entity:{},entityname:"",data:{},errordata:{},model:{id:""},state:[],entityid:"",currentView:"scaffold-form-template",currentparent:{},issuperuser:window.IsSuperUser,listtransition:!1},mounted:function(){var t=Mura.getQueryStringParams();if(t.entityname||Mura.extend(t,this.getStoredState()),this.currentView="",t.entityname){var i=["content","user","group","category","comment","address","changeset"].indexOf(t.entityname)>-1;if(t.entityid)if(t.relatesto){var r=this;e.get(function(e){e.entity.exists()?r.showRelatedList(t.relatesto,e.entity,!0):r.showList(t.entityname)},t.entityname,t.entityid,{},{},!0)}else i?t.relatesto?this.showList(t.relatesto):this.showList("entity"):this.showForm(t.entityname,t.entityid);else i?this.showList("entity"):t.relatesto?this.showList(t.relatesto):this.showList("entity")}else this.showList("entity")},destroyed:function(){console.log("main destroyed")},methods:{setStoredState:function(t){"object"==typeof t&&Mura.createCookie("mura_scaffolder",encodeURIComponent(JSON.stringify(t)))},getStoredState:function(){Mura.getQueryStringParams();try{var t=Mura.readCookie("mura_scaffolder");"object"!=typeof(t=JSON.parse(t))&&(t={})}catch(e){t={}}return t},clickSave:function(t){this.errordata={};var r=this;for(i in Mura(".selector-file").forEach(function(){var t=Mura(this);r.model[t.attr("name")]=t.val()}),CKEDITOR.instances)CKEDITOR.instances[i].updateElement(),this.model[i]=CKEDITOR.instances[i].getData();e.save(this.doneFormProcessing,t,this.model)},clickBack:function(){this.errordata={},this.showList(this.entityname)},clickDelete:function(t){this.errordata={},confirm("Are you sure you wish to delete this? ")&&e.delete(this.doneFormProcessing,t,this.model)},clickCrumb:function(t){this.errordata={};var i=this.state[t];this.state=this.state.splice(0,this.state.length-(this.state.length-t)),i.parent?e.get(this.doForm,i.parent.entityname,i.parent.id,i.parent):this.showList(i.name)},doneFormProcessing:function(t,i){if(i){var r=this;return r.data.model=t.getAll(),r.data.model._displaylist=[],r.data.entity=t,r.model=r.data.model,r.errordata=r.data.model.errors,t.get("properties").then(function(t){r.data.properties=t.properties.properties,e.processProperties(r.data);for(var i=0;i<r.data.properties.length;i++)r.data.properties[i].listview?r.data.model._displaylist.push(r.data.properties[i]):r.data.properties[i].fieldtype,"datetime"!=r.data.properties[i].datatype&&"date"!=r.data.properties[i].datatype||(r.data.model[r.data.properties[i].name]=e.formatDate(r.data.model[r.data.properties[i].name]));this.currentView="",this.currentView="scaffold-form-template"},function(t){console.log("error!"),console.log(t)}),void console.log("errors!")}this.errordata={};this.state.pop();this.currentparent.properties?this.showRelatedList(this.entityname,this.currentparent):this.showList(this.entityname)},showAll:function(t){this.currentparent={},this.sortBy="",this.sortDir="",e.all(this.doAll)},hide:function(){this.currentView=""},doAll:function(t){this.data.items=t.items,this.currentView="scaffold-all-template"},showForm:function(t,i,r){this.entityid=i,this.errordata={},this.entityname=t,this.setStoredState({entityid:this.entityid,entityname:this.entityname}),this.currentparent.properties&&this.currentparent.properties.entityname==t&&(this.currentparent={}),e.get(this.doForm,t,i||"new")},doForm:function(t){this.model=t.model,this.data=t,this.errordata={},this.currentparent.properties&&(this.model[this.currentparent.properties.properties.primarykey]=this.currentparent.properties.id),this.state.length>1&&this.state[this.state.length-1].parent?this.data.parent=this.state[this.state.length-1].parent:this.data.parent=null,this.currentView="scaffold-form-template"},showList:function(t){"entity"==t&&(this.currentparent={}),this.setStoredState({entityname:this.entityname}),this.sortBy="",this.sortDir="",this.entityname=t,this.currentView="scaffold-list-template",e.feed(this.doList,t,this.itemsper,this.sortBy,this.sortDir)},doList:function(t){t.listtransition=!1,this.data=t,this.data.issuperuser=window.IsSuperUser,this.currentView="scaffold-list-template"},showRelatedList:function(t,i){this.entityname=t,this.currentView="scaffold-list-template",this.currentparent=i,this.setStoredState({entityname:this.currentparent.get("entityname"),entityid:this.currentparent.get("id"),relatesto:this.entityname});var r=this;this.currentparent.get("properties").then(function(i){for(var o=[],s=i.getAll(),n=0;n<s.properties.length;n++)if(s.properties[n].fieldtype&&("one-to-many"==s.properties[n].fieldtype||"many-to-many"==s.properties[n].fieldtype)&&s.properties[n].relatesto==r.entityname)var a={property:"primaryKey"==s.properties[n].loadkey?s.primarykey:s.properties[n].loadkey,value:"primaryKey"==s.properties[n].fkcolumn?r.currentparent.properties[s.primarykey]:r.currentparent.properties[s.properties[n].fkcolumn]};a?o.push(a):o.push({property:s.primarykey,value:r.currentparent.properties[s.primarykey]}),e.feed(r.doRelatedList,t,r.itemsper,r.sortBy,r.sortDir,o,!1)})},doRelatedList:function(t){this.data=t,this.currentView="scaffold-list-template"},applyFilter:function(){e.feed(this.doList,this.entityname,this.itemsper,this.sortBy,this.sortDir)},removeFilter:function(){Mura(".filter").val(""),e.feed(this.doList,this.entityname,this.itemsper,this.sortBy,this.sortDir)},applyKeyFilter:function(t){13==t.keyCode&&e.feed(this.doList,this.entityname,this.itemsper,this.sortBy,this.sortDir)},applyItemsPer:function(t){this.itemsper=t,e.feed(this.doList,this.entityname,this.itemsper,this.sortBy,this.sortDir)},applySortBy:function(t){this.sortBy=t,this.sortDir=""==this.sortDir?"desc":"desc"==this.sortDir?"asc":"desc",Mura("#sortarrow").remove(),"asc"==this.sortDir?Mura("#sortby-"+t).append("<i class='mi-sort-asc' id='sortarrow'></i>"):Mura("#sortby-"+t).append("<i class='mi-sort-desc' id='sortarrow'></i>"),e.feed(this.doList,this.entityname,this.itemsper,this.sortBy,this.sortDir)},applyPage:function(t){e.page(this.doList,this.data.collection,t)},show:function(){this.isvisible=!0,this.showList("entity")},hide:function(){this.isvisible=!1}}})});